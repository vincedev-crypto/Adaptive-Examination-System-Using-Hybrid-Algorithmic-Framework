<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Student Submissions - ALGO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .grading-card {
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.06);
        }
        .stat-badge {
            padding: 18px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-number {
            font-size: 1.9rem;
            font-weight: 700;
        }
    </style>
</head>
<body class="homepage-page">

<div class="teacher-layout">
    <div th:replace="teacher-nav :: teacherNav"></div>

    <div class="teacher-content-wrapper">
    <div class="container">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="text-primary mb-1"><i class="bi bi-clipboard-check"></i> Grade Student Submissions</h2>
                <p class="text-muted mb-0">Review and grade open-ended questions, then finalize scores.</p>
            </div>
            <a th:href="@{/teacher/submissions}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to Submissions
            </a>
        </div>

        <!-- Statistics -->
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <div class="stat-badge bg-warning text-white upload-card">
                    <div class="stat-number" th:text="${totalPending}">0</div>
                    <div>Pending Grading</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="stat-badge bg-success text-white upload-card">
                    <div class="stat-number" th:text="${gradedSubmissions.size()}">0</div>
                    <div>Graded</div>
                </div>
            </div>
        </div>

        <!-- Pending Grading Section -->
        <div class="grading-card p-4 mb-4" th:if="${!#lists.isEmpty(pendingGrading)}">
            <h4 class="text-warning mb-3">
                <i class="bi bi-hourglass-split"></i> Pending Grading
            </h4>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Exam</th>
                            <th>Submitted</th>
                            <th>Auto Score</th>
                            <th>Percentage</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="submission : ${pendingGrading}">
                            <td><strong th:text="${submission.studentEmail}"></strong></td>
                            <td th:text="${submission.examName}"></td>
                            <td th:text="${#temporals.format(submission.submittedAt, 'MMM dd, yyyy HH:mm')}"></td>
                            <td>
                                <span class="badge bg-secondary" th:text="${submission.score + ' / ' + submission.totalQuestions}"></span>
                            </td>
                            <td>
                                <span class="badge" 
                                      th:classappend="${submission.percentage >= 80 ? 'bg-success' : submission.percentage >= 60 ? 'bg-info' : submission.percentage >= 40 ? 'bg-warning' : 'bg-danger'}"
                                      th:text="${#numbers.formatDecimal(submission.percentage, 1, 1) + '%'}"></span>
                            </td>
                            <td>
                                <a th:href="@{/teacher/grade/{id}(id=${submission.id})}" 
                                   class="btn btn-sm btn-warning">
                                    <i class="bi bi-pencil-square"></i> Grade Now
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="grading-card p-4 mb-4" th:if="${#lists.isEmpty(pendingGrading)}">
            <div class="alert alert-success mb-0">
                <i class="bi bi-check-circle"></i> No submissions pending grading!
            </div>
        </div>

        <!-- Graded Submissions Section -->
        <div class="grading-card p-4" th:if="${!#lists.isEmpty(gradedSubmissions)}">
            <h4 class="text-success mb-3">
                <i class="bi bi-check2-circle"></i> Graded Submissions
            </h4>
            <div class="table-responsive">
                <table class="table table-hover table-sm">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Exam</th>
                            <th>Graded</th>
                            <th>Auto Score</th>
                            <th>Manual Score</th>
                            <th>Final Score</th>
                            <th>Final %</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="submission : ${gradedSubmissions}">
                            <td th:text="${submission.studentEmail}"></td>
                            <td th:text="${submission.examName}"></td>
                            <td th:text="${#temporals.format(submission.gradedAt, 'MMM dd, HH:mm')}"></td>
                            <td><span class="badge bg-secondary" th:text="${submission.score}"></span></td>
                            <td><span class="badge bg-primary" th:text="${submission.manualScore != null ? submission.manualScore : 0}"></span></td>
                            <td>
                                <span class="badge bg-success" th:text="${submission.finalScore + ' / ' + submission.totalQuestions}"></span>
                            </td>
                            <td>
                                <span class="badge"
                                      th:classappend="${submission.finalPercentage >= 80 ? 'bg-success' : submission.finalPercentage >= 60 ? 'bg-info' : submission.finalPercentage >= 40 ? 'bg-warning' : 'bg-danger'}"
                                      th:text="${#numbers.formatDecimal(submission.finalPercentage, 1, 1) + '%'}"></span>
                            </td>
                            <td>
                                <a th:href="@{/teacher/grade/{id}(id=${submission.id})}" 
                                   class="btn btn-sm btn-outline-secondary">
                                    <i class="bi bi-eye"></i> View
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
